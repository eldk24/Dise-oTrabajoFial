<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <link rel="stylesheet" href="/css/style.css">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #1e1e2f;
      margin: 0;
      padding: 20px;
      color: #f1f1f1;
    }

    .dashboard-container {
      max-width: 1200px;
      margin: auto;
      position: relative;
    }

    .logout-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #ff7043;
      color: #fff;
      padding: 10px 15px;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }

    .logout-btn:hover {
      background: #f4511e;
    }

    h1, h2, h3 {
      text-align: center;
      color: #ffffff;
    }

    /* Formulario */
    .product-form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 15px;
      background: #2c2f3a;
      padding: 25px;
      border-radius: 10px;
      margin-bottom: 40px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
    }

    .product-form input,
    .product-form select,
    .product-form button {
      padding: 12px;
      border-radius: 6px;
      border: none;
      font-size: 15px;
    }

    .product-form input,
    .product-form select {
      background-color: #3a3f51;
      color: #f1f1f1;
    }

    .product-form button {
      background: #00c853;
      color: #fff;
      font-weight: bold;
      transition: background 0.3s;
    }

    .product-form button:hover {
      background: #00b344;
      cursor: pointer;
    }

    /* Catálogo */
    .product-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
    }

    .product-card {
      background: #2c2f3a;
      border-radius: 10px;
      width: 220px;
      padding: 15px;
      box-shadow: 0 0 12px rgba(0, 0, 0, 0.2);
      text-align: center;
      transition: transform 0.2s;
    }

    .product-card:hover {
      transform: scale(1.03);
    }

    .product-card img {
      max-width: 100%;
      height: 160px;
      object-fit: cover;
      border-radius: 6px;
      margin-bottom: 10px;
    }

    .product-card h3 {
      margin: 8px 0;
      color: #ffffff;
    }

    .product-card p {
      margin: 4px 0;
      font-size: 14px;
    }

    .product-card form button {
      background: #ff5252;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      margin-top: 10px;
      transition: background 0.3s;
    }

    .product-card form button:hover {
      background: #e53935;
      cursor: pointer;
    }

    .stock-out {
      color: #ff6e6e;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="dashboard-container">

    <!-- Botón de cerrar sesión -->
    <form id="logoutForm" method="POST" action="/logout">
      <button type="button" class="logout-btn" onclick="confirmLogout()">Cerrar sesión</button>
    </form>

    <h1>Bienvenido, <%= user.username %> 👋</h1>

    <form class="product-form" method="POST" action="/add-product">
      <input type="text" name="name" placeholder="Nombre del producto" required>

      <select name="category" required>
        <option value="">-- Categoría --</option>
        <option value="Polos">Polos</option>
        <option value="Pantalones">Pantalones</option>
        <option value="Camisas">Camisas</option>
        <option value="Casacas">Casacas</option>
        <option value="Blusas">Blusas</option>
        <option value="Chompas">Chompas</option>
        <option value="Poleras">Poleras</option>
      </select>

      <input type="number" name="price" step="0.01" placeholder="Precio (S/.)" required>
      <input type="text" name="image" placeholder="URL de imagen" required>
      <input type="number" name="stock" min="0" placeholder="Cantidad en stock" required>

      <button type="submit">Agregar producto</button>
    </form>

    <h2>Catálogo por Categoría</h2>

    <% Object.keys(productsByCategory).forEach(category => { %>
      <% if (productsByCategory[category].length > 0) { %>
        <h3><%= category %></h3>
        <div class="product-grid">
          <% productsByCategory[category].forEach(p => { %>
            <div class="product-card">
              <img src="<%= p.image %>" alt="<%= p.name %>">
              <h3><%= p.name %></h3>
              <p>Precio: S/. <%= p.price %></p>
              <p class="<%= p.stock === 0 ? 'stock-out' : '' %>">
                Stock: <%= p.stock %> unidades
              </p>
              <form method="POST" action="/delete-product/<%= p.id %>">
                <button>Eliminar</button>
              </form>
            </div>
          <% }) %>
        </div>
      <% } %>
    <% }) %>
  </div>

  <!-- Confirmación al cerrar sesión -->
  <script>
    function confirmLogout() {
      if (confirm("¿Estás seguro de que deseas cerrar sesión?")) {
        document.getElementById('logoutForm').submit();
      }
    }
  </script>
  <a href="/logout" onclick="return confirm('¿Seguro que deseas cerrar sesión?')" style="color:white; background:red; padding:10px; border-radius:5px;">Cerrar sesión</a>

</body>
</html>
